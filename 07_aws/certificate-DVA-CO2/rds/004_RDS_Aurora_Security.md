# π€ RDS & Aurora Security

Amazon RDSμ™€ Auroraλ” λ°μ΄ν„° λ³΄νΈ, μ ‘κ·Ό μ μ–΄, λ΅κΉ…, λ„¤νΈμ›ν¬ λ³΄μ•μ„ μ„ν• μ—¬λ¬ λ©”μ»¤λ‹μ¦μ„ μ κ³µν•©λ‹λ‹¤.
μ•„λλ” λ³΄μ• μμ—­λ³„λ΅ μ •λ¦¬ν• ν•µμ‹¬ κ°λ…μ…λ‹λ‹¤.

## π§± 1οΈβƒ£ λ°μ΄ν„° μ•”νΈν™” (Encryption)

- At-rest Encryption (μ €μ¥ μ¤‘ μ•”νΈν™”)
- λΉ„μ•”νΈν™” DBλ¥Ό μ•”νΈν™”
- In-flight Encryption (μ „μ†΅ μ¤‘ μ•”νΈν™”)

### π—„οΈ At-rest Encryption (μ €μ¥ μ¤‘ μ•”νΈν™”)

- λ°μ΄ν„°κ°€ λ””μ¤ν¬(EBS) μ— μ €μ¥λ  λ• μ•”νΈν™”
- AWS KMS (Key Management Service) μ‚¬μ©
- DB μƒμ„± μ‹μ (Launch Time) μ—λ§ μ„¤μ • κ°€λ¥
  - β†’ μ΄λ―Έ μƒμ„±λ DBλ” λ‚μ¤‘μ— μ•”νΈν™” λ¶κ°€
- β οΈ λ§μ¤ν„° DBκ°€ μ•”νΈν™”λμ§€ μ•μ•λ‹¤λ©΄, ν•΄λ‹Ή DBμ Read Replicaλ„ μ•”νΈν™”ν•  μ μ—†μ

#### β€RDSμ At-rest encryption (μ €μ¥ μ¤‘ μ•”νΈν™”)β€ λ” μ»¬λΌ κ°’μ΄ μ•”νΈν™”λμ–΄ μ €μ¥λλ” κ²ƒμ΄ μ•„λ‹

- λ””μ¤ν¬μ— μ €μ¥λ μƒνƒ(=at rest)μ λ°μ΄ν„°λ¥Ό λ³΄νΈν•λ” μ•”νΈν™”
  - DB νμΌ
  - λ΅κ·Έ νμΌ
  - λ°±μ—… μ¤λƒ…μƒ·
  - μ„μ‹ μ¤ν† λ¦¬μ§€

π‘‰ μ„μ™€ κ°™μ€ λ¬Όλ¦¬μ μΈ μ¤ν† λ¦¬μ§€μ— μ €μ¥λ λ°μ΄ν„°λ¥Ό AWS KMS(Key Management Service)λ¥Ό μ΄μ©ν•΄,
μλ™μΌλ΅ μ•”νΈν™” ν•λ” κΈ°λ¥μ…λ‹λ‹¤. **_μ¦‰, DB λ‚΄λ¶€ κ°’(μ»¬λΌ κ°’)μ€ ν‰λ¬Έ κ·Έλ€λ΅ μ μ§€λκ³ _**,
λ””μ¤ν¬ λ‹¨(HDD/EBS λΈ”λ΅ λ‹¨μ„)μ—μ„ μ•”νΈν™”κ°€ μ΄λ£¨μ–΄μ§‘λ‹λ‹¤. λ¬Όλ¦¬μ μΈ μ¤ν† λ¦¬μ§€μ— μ €μ¥λ λ°μ΄ν„°λ¥Ό
AWS KMS(Key Management Service) λ¥Ό μ΄μ©ν•΄ μλ™μΌλ΅ μ•”νΈν™”ν•λ” κΈ°λ¥μ…λ‹λ‹¤.

```shell
[μ‚¬μ©μ μΏΌλ¦¬] β†’ DB μ—”μ§„(ν‰λ¬Έ μ²λ¦¬)
              β†“
       [λ””μ¤ν¬μ— μ €μ¥]
              β†“
   EBS μμ¤€μ—μ„ μ•”νΈν™” (KMS Key μ‚¬μ©)
```

#### μμ‹λ΅ μ΄ν•΄ν•κΈ°

μλ¥Ό λ“¤μ–΄, μ•„λμ™€ κ°™μ€ ν…μ΄λΈ”μ΄ μλ‹¤κ³  ν•©μ‹λ‹¤:

```shell
CREATE TABLE customer (
    id SERIAL PRIMARY KEY,
    name VARCHAR(100),
    ssn VARCHAR(20)
);

INSERT INTO customer (name, ssn)
VALUES ('ν™κΈΈλ™', '990101-1234567');
```

- RDSμ—μ„ At-rest encryptionμ΄ ν™μ„±ν™”λμ–΄ μλ‹¤λ©΄
  - β†’ μ΄ λ°μ΄ν„°κ°€ λ””μ¤ν¬μ— μ €μ¥λ  λ• KMS ν‚¤λ΅ μ•”νΈν™”λ ν•νƒλ΅ EBSμ— μ €μ¥λ©λ‹λ‹¤.
- ν•μ§€λ§ SQLλ΅ μ΅°νν•  λ•λ” μ΄λ ‡κ² ν‰λ¬Έμ΄ λ‚μµλ‹λ‹¤ π‘‡

```shell
SELECT * FROM customer;
-- κ²°κ³Ό: ν™κΈΈλ™ | 990101-1234567
```

μ¦‰, **μ»¬λΌ κ°’ μμ²΄κ°€ μ•”νΈν™”λμ–΄ μμ§€λ” μ•μµλ‹λ‹¤.** DB λ‚΄λ¶€μ—μ„λ” ν‰λ¬Έ μƒνƒλ΅ μ΅΄μ¬ν•μ§€λ§, λ””μ¤ν¬ νμΌμ΄
νƒμ·¨λλ”λΌλ„ λ³µνΈν™” ν‚¤(KMS Key) μ—†μ΄λ” μ½μ„ μ μ—†μµλ‹λ‹¤.

### π”„ λΉ„μ•”νΈν™” DBλ¥Ό μ•”νΈν™”ν•λ ¤λ©΄

- λΉ„μ•”νΈν™” DBμ μ¤λƒ…μƒ·(Snapshot) μƒμ„±
- ν•΄λ‹Ή μ¤λƒ…μƒ·μ„ Encrypted Snapshot μΌλ΅ λ³µμ 
- μ•”νΈν™”λ μ¤λƒ…μƒ·μ„ κΈ°λ°μΌλ΅ μƒ RDS μΈμ¤ν„΄μ¤ μƒμ„±

### π In-flight Encryption (μ „μ†΅ μ¤‘ μ•”νΈν™”, In-transit)

- DBμ™€ ν΄λΌμ΄μ–ΈνΈ κ°„μ λ°μ΄ν„° μ „μ†΅ μ‹ TLS/SSL μ•”νΈν™”
- κΈ°λ³Έμ μΌλ΅ TLS-ready μƒνƒ
- ν΄λΌμ΄μ–ΈνΈ μΈ΅μ—μ„ AWS TLS Root Certificate μ„¤μΉ ν›„ μ—°κ²° ν•„μ”

> β… μμ‹: sslmode=require μµμ…μ„ JDBC URLμ— μ¶”κ°€

```shell
jdbc:postgresql://myspeech-db.xxxxxx.ap-northeast-2.rds.amazonaws.com:5432/appdb?sslmode=require
```

#### π§¶ μ΅°κΈ λ” μμ„Έν

In-flight Encryption(μ „μ†΅ μ¤‘ μ•”νΈν™”, In-transit)μ€ λ°μ΄ν„°κ°€ λ„¤νΈμ›ν¬λ¥Ό ν†µν•΄ μ΄λ™ν•  λ•(μ „μ†΅ μ¤‘)
μ¤‘κ°„μ—μ„ νƒμ·¨λκ±°λ‚ λ³€μ΅°λμ§€ μ•λ„λ΅ μ•”νΈν™” ν•λ” κΈ°μ μ…λ‹λ‹¤.

μ¦‰,

- DB μ„λ²„ β†” μ• ν”λ¦¬μΌ€μ΄μ…(ν΄λΌμ΄μ–ΈνΈ) κ°„μ— TLS/SSL ν”„λ΅ν† μ½μ„ μ΄μ©ν•΄ λ°μ΄ν„°λ¥Ό μ•”νΈν™”λ μ±„λ΅ μ „μ†΅ν•©λ‹λ‹¤.

#### π”’ μ‹¤μ λ΅ μΌμ–΄λ‚λ” κ³Όμ •

π“΅ λ°μ΄ν„° νλ¦„ μμ‹ (Spring Boot β†’ AWS RDS)

```shell
[Java Spring App]  β‡„  [RDS DB Instance]
         β”‚                   β”‚
         β”‚  TLS Handshake    β”‚   β† (μ„λ΅ μΈμ¦μ„ κµν™)
         β”‚  Session Key μƒμ„±  β”‚
         β”‚                   β”‚
         β”‚  μ•”νΈν™”λ λ°μ΄ν„° μ†΅μμ‹  (AES λ“±)  β”‚
```

- Spring μ• ν”λ¦¬μΌ€μ΄μ…μ΄ DBμ— μ—°κ²°ν•  λ•,
  - JDBC λ“λΌμ΄λ²„κ°€ TLS ν•Έλ“μ…°μ΄ν¬(Handshake) λ¥Ό μν–‰ν•©λ‹λ‹¤.
- AWS RDSλ” μ„λ²„ μΈμ¦μ„(SSL Certificate) λ¥Ό μ μ‹ν•κ³ ,
  - μ• ν”λ¦¬μΌ€μ΄μ…μ€ AWS Root CA μΈμ¦μ„λ¥Ό μ΄μ©ν•΄ κ·Έ μ ν¨μ„±μ„ κ²€μ¦ν•©λ‹λ‹¤.
- λ‘ μ‚¬μ΄μ— μ„Έμ… μ•”νΈν‚¤(Session Key) κ°€ λ§λ“¤μ–΄μ§€κ³ ,
  - μ΄ν›„ λ¨λ“  SQL μ”μ²­/μ‘λ‹µμ΄ μ΄ ν‚¤λ΅ μ•”Β·λ³µνΈν™”λμ–΄ μ „μ†΅λ©λ‹λ‹¤.
- λ°μ΄ν„°λ” DBλ΅ λ³΄λ‚΄μ§ λ• μ•”νΈν™”λμ–΄ μ „μ†΅,
  - DBμ—μ„ λ°›μ„ λ• λ³µνΈν™”λμ–΄ μμ‹ λ©λ‹λ‹¤.

β… λ„¤νΈμ›ν¬ κµ¬κ°„μ—μ„λ§ μ•”νΈν™”κ°€ μ μ©λλ©°, DB λ‚΄λ¶€μ— μ €μ¥λ  λ•λ” ν‰λ¬Έ λ°μ΄ν„°λ΅ μ΅΄μ¬ν•©λ‹λ‹¤.

#### Springboot μ„¤μ • μμ‹

```yml
# postgresql μ κ²½μ°
spring:
  datasource:
    url: jdbc:postgresql://myspeech-db.abcdefg123.ap-northeast-2.rds.amazonaws.com:5432/appdb?sslmode=require
    username: admin
    password: mypassword

# mysql μ κ²½μ°
spring:
  datasource:
    url: jdbc:mysql://myspeech-db.abcdefg123.ap-northeast-2.rds.amazonaws.com:3306/appdb?useSSL=true&requireSSL=true
```

sslmode=require λ¥Ό μ„¤μ •ν•λ©΄ Spring JDBCκ°€ TLS μ—°κ²°μ„ κ°•μ ν•©λ‹λ‹¤.

> κ·Έλ¦¬κ³  μ—°κ²°ν•λ” μ„λ²„(EC2, λ΅μ»¬ λ“±)μ— AWSμ—μ„ μ κ³µν•λ” Root CA μΈμ¦μ„λ¥Ό μ„¤μΉν•΄μ•Ό ν•©λ‹λ‹¤.
>
> (μ: rds-combined-ca-bundle.pem)

---

## π‘¤ 2οΈβƒ£ IAM κΈ°λ° μΈμ¦ (IAM Authentication)

- κΈ°μ΅΄μ DB μ‚¬μ©μ μ΄λ¦„/λΉ„λ°€λ²νΈ λ€μ‹  IAM Role λλ” IAM Token μΌλ΅ λ΅κ·ΈμΈ κ°€λ¥
- μμ‹:
  - EC2 μΈμ¤ν„΄μ¤κ°€ DBμ— μ ‘κ·Όν•  λ•
    - β†’ IAM Role λ¶€μ—¬ β†’ RDS μΈμ¦ ν† ν°μΌλ΅ λ΅κ·ΈμΈ
    - μΈμ¦ ν† ν°μ€ 15λ¶„κ°„ μ ν¨ν• μ„μ‹ μκ²© μ¦λ…

μ¥μ 

- λΉ„λ°€λ²νΈλ¥Ό μ• ν”λ¦¬μΌ€μ΄μ… μ½”λ“μ— μ €μ¥ν•μ§€ μ•μ•„λ„ λ¨
- IAM μ •μ±…μΌλ΅ μ ‘κ·Ό ν†µμ  κ°€λ¥

---

## 3οΈβƒ£ λ„¤νΈμ›ν¬ μ ‘κ·Ό μ μ–΄ (Security Groups)

- RDS μΈμ¤ν„΄μ¤μ— λ€ν• μΈλ°”μ΄λ“ νΈλν”½ μ μ–΄
- EC2 μΈμ¤ν„΄μ¤ λλ” νΉμ • IPλ§ μ ‘κ·Ό ν—μ© κ°€λ¥
- VPC λ‚΄μ—μ„ μ ‘κ·Ό μ μ–΄ (VPC Security Group)

μμ‹

- EC2 β†’ RDS μ ‘κ·Ό ν—μ©
- νΉμ • ν¬νΈ (μ: 5432)λ§ μ¤ν”
- νΌλΈ”λ¦­ μ•΅μ„Έμ¤ μ°¨λ‹¨ (Publicly Accessible = false)

## 4οΈβƒ£ μ΄μμ²΄μ  μ ‘κ·Ό (OS Access)

- RDS / Auroraλ” SSH μ ‘μ† λ¶κ°€λ¥
- OS λ λ²¨μ— μ§μ ‘ μ ‘κ·Όν•  μ μ—†μΌλ©°, RDS Custom λ§ μμ™Έμ μΌλ΅ SSH μ ‘κ·Ό ν—μ©

> RDS Custom = DB μ—”μ§„μ„ λ” μ„Έλ°€ν•κ² μ μ–΄ν•΄μ•Ό ν•λ” νΉμμ© λ²„μ „
>
> (μ: Oracle Custom, SQL Server Custom)

---

## 5οΈβƒ£ κ°μ‚¬ λ° λ΅κΉ… (Audit Logging)

- DB ν™λ™ λ΅κ·Έλ¥Ό CloudWatch Logs λ΅ μ „μ†΅ κ°€λ¥ β†’ μ¥κΈ° λ³΄κ΄€ λ° λ¶„μ„ κ°€λ¥
- λ΅κ·Έ μΆ…λ¥:
  - Error Logs
  - Slow Query Logs
  - General Logs
  - Audit Logs (νΉμ • μ΄λ²¤νΈ μ¶”μ μ©)

β… λ΅κ·Έλ¥Ό CloudWatchλ΅ λ³΄λ‚΄λ©΄ Athenaλ‚ Lambdaλ΅ μ¶”κ°€ λ¶„μ„ κ°€λ¥

---

## ETC

### Audit λ΅κ·Έλ€?

Audit λ΅κ·Έλ” λ„κ°€ μ–Έμ  λ¬΄μ—‡μ„ ν–λ”μ§€ μ¶”μ ν•κΈ° μ„ν• λ³΄μ• κ°μ‚¬μ© λ΅κ·Έμ…λ‹λ‹¤.
μ¦‰, **μ‚¬μ©μ ν™λ™ μ¶”μ  λ΅κ·Έ** λΌκ³  μƒκ°ν•λ©΄ λ©λ‹λ‹¤.
