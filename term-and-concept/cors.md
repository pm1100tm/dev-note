# CORS

## ğŸ§ What is CORS(Cross-Origin Resource Sharing, êµì°¨ ì¶œì²˜ ë¦¬ì†ŒìŠ¤ ê³µìœ )

ì›¹ ë¸Œë¼ìš°ì €ëŠ” ë³´ì•ˆ ìƒì˜ ì´ìœ ë¡œ ë™ì¼ ì¶œì²˜ ì •ì±…(Same-Origin Policy)ì„ ë”°ë¥¸ë‹¤. ì´ëŠ” í•œ ì¶œì²˜ì—ì„œ
ë¶ˆëŸ¬ì˜¨ ì›¹ í˜ì´ì§€ê°€ ë‹¤ë¥¸ ì¶œì²˜ì˜ ìì›ì— ì ‘ê·¼í•˜ëŠ” ê²ƒì„ ì œí•œí•œë‹¤. ë”°ë¼ì„œ, ë™ì¼ ì¶œì²˜ ì •ì±…ì€ ì•…ì„± ì›¹ì‚¬ì´íŠ¸ë‚˜
ìŠ¤í¬ë¦½íŠ¸ê°€ ì¿ í‚¤ë¥¼ ì‚¬ìš©í•˜ì—¬ ë‹¤ë¥¸ ì›¹ì‚¬ì´íŠ¸ì—ì„œ ì‘ì—…ì„ ìˆ˜í–‰í•˜ëŠ” ê²ƒì„ ë°©ì§€í•˜ëŠ” ë³´í˜¸ ê³„ì¸µ ì¤‘ í•˜ë‚˜ë¡œ ì‘ìš©í•œë‹¤.

CORSëŠ” **ì´ëŸ¬í•œ ì œí•œì„ ì™„í™”**í•˜ê¸° ìœ„í•´ ì‚¬ìš©ëœë‹¤.

- ì›¹ ë¸Œë¼ìš°ì €ì— ë‚´ì¥ë˜ì–´ ìˆë‹¤.
- HTTP í—¤ë”ë¥¼ ê¸°ë°˜ìœ¼ë¡œ êµì°¨ ì¶œì²˜ ìš”ì²­ì„ í—ˆìš©í•˜ëŠ” ê²ƒì´ ì•ˆì „í•œì§€ ì—¬ë¶€ë¥¼ ê²°ì •í•œë‹¤.
- CORSëŠ” ì›¹ ì• í”Œë¦¬ì¼€ì´ì…˜ì´ ë‹¤ë¥¸ ë„ë©”ì¸ì—ì„œ ìì›ì„ ìš”ì²­/ê±°ë¶€ í•  ìˆ˜ ìˆë„ë¡ í•˜ëŠ” ë©”ì»¤ë‹ˆì¦˜ì´ë‹¤.

![cors-error](./assets/cors-error.png)

## ğŸ‘ CORS ë™ì‘ ë°©ì‹

### Preflight Request

OPTIONS ë©”ì„œë“œë¥¼ ì‚¬ìš©í•˜ì—¬ ë¸Œë¼ìš°ì €ê°€ ì„œë²„ì— ì‹¤ì œ ìš”ì²­ì„ ë³´ë‚´ê¸° ì „ì— í—ˆìš©ëœ ë©”ì„œë“œì™€ í—¤ë”ë¥¼ í™•ì¸í•œë‹¤.

- Access-Control-Allow-Origin: ì„œë²„ëŠ” ì´ í—¤ë”ë¥¼ í†µí•´ ì–´ë–¤ ì¶œì²˜ì˜ ìš”ì²­ì„ í—ˆìš©í• ì§€ ëª…ì‹œ
- Access-Control-Allow-Methods: í—ˆìš©ëœ HTTP ë©”ì„œë“œë¥¼ ëª…ì‹œ
- Access-Control-Allow-Headers: í—ˆìš©ëœ HTTP í—¤ë”ë¥¼ ëª…ì‹œ

ì˜ˆì‹œ

```shell
Access-Control-Allow-Origin: https://example.com
Access-Control-Allow-Methods: GET, POST
Access-Control-Allow-Headers: Content-Type
```

## ğŸ§ What is Origin

Originì€ ì•„ë˜ì˜ êµ¬ì„±ìœ¼ë¡œ ì´ë£¨ì–´ì§„ URLì˜ ì¼ë¶€ì´ë‹¤.

- í”„ë¡œí† ì½œ(ex: HTTP, HTTPS, ...)
- ë„ë©”ì¸(ex: google.com)
- í¬íŠ¸(ex: 443 - SSL(Secure Sockets Layer)ì„ ìœ„í•œ ê¸°ë³¸ í¬íŠ¸ë²ˆí˜¸)
- ex\) https://google.com:443

HTTPSì˜ ê¸°ë³¸ í¬íŠ¸ëŠ” 443ì´ë¯€ë¡œ https://google.com ë¡œ ë‹¨ì¶• í•  ìˆ˜ ìˆë‹¤.

### âš¡ï¸ ë™ì¼í•œ URLì˜ ì˜ˆì‹œ

- https://google.com
- https://google.com:443
- https://google.com/search?q=test

### âš¡ï¸ ë™ì¼í•˜ì§€ ì•Šì€ URLì˜ ì˜ˆì‹œ

- https://google.com:8080
- https://www.google.com
- http://google.com
- https://reddit.com

### SameSite ì¿ í‚¤ ì†ì„±

- ì¿ í‚¤ì˜ ë³´ì•ˆ ì†ì„±
- ì¿ í‚¤ê°€ ë‹¤ë¥¸ ì¶œì²˜ì˜ ìš”ì²­ì— í¬í•¨ë˜ëŠ” ë°©ì‹ì„ ì œì–´
- SameSite ì†ì„±ì€ CSRF(Cross-Site Request Forgery) ê³µê²©ì„ ë°©ì§€í•˜ëŠ” ë° ë„ì›€ì„ ì¤Œ

SameSiteì˜ ì†ì„± ê°’ì€ ì•„ë˜ì™€ ê°™ë‹¤.

#### Strict

- ì¿ í‚¤ëŠ” ë™ì¼ ì¶œì²˜ì˜ ìš”ì²­ì—ë§Œ í¬í•¨í•œë‹¤.
- ë‹¤ë¥¸ ì¶œì²˜ì—ì„œì˜ ìš”ì²­ì€ ì¿ í‚¤ë¥¼ ì „ì†¡í•˜ì§€ ì•ŠëŠ”ë‹¤.

#### Lax

- ì¼ë¶€ ì•ˆì „í•œ í¬ë¡œìŠ¤ì‚¬ì´íŠ¸ ìš”ì²­(GET ë©”ì„œë“œì™€ ê°™ì€)ì—ëŠ” ì¿ í‚¤ë¥¼ í¬í•¨í•œë‹¤.
- ê·¸ ì™¸ ë‹¤ë¥¸ ìœ í˜•ì˜ ìš”ì²­ì—ëŠ” í¬í•¨í•˜ì§€ ì•ŠëŠ”ë‹¤.

#### None

- ëª¨ë“  í¬ë¡œìŠ¤ì‚¬ì´íŠ¸ ìš”ì²­ì— ì¿ í‚¤ë¥¼ í¬í•¨í•©ë‹ˆë‹¤.
- ì´ ê²½ìš°, Secure ì†ì„±ì„ í•¨ê»˜ ì‚¬ìš©í•´ì•¼ í•©ë‹ˆë‹¤.

ì˜ˆì‹œ

```shell
Set-Cookie: sessionId=abc123; SameSite=Strict
Set-Cookie: sessionId=abc123; SameSite=Lax
Set-Cookie: sessionId=abc123; SameSite=None; Secure
```

### CORSì™€ SameSiteì˜ ê´€ë ¨ì„±

- CORS: í´ë¼ì´ì–¸íŠ¸ì™€ ì„œë²„ ê°„ì˜ ìš”ì²­ì„ ì œì–´í•˜ì—¬ í¬ë¡œìŠ¤ ë„ë©”ì¸ ìš”ì²­ì„ ì•ˆì „í•˜ê²Œ í—ˆìš©í•˜ëŠ” ë° ì‚¬ìš©
- SameSite: ì¿ í‚¤ì˜ í¬í•¨ ì—¬ë¶€ë¥¼ ì œì–´í•˜ì—¬ CSRF ê³µê²©ì„ ë°©ì§€í•˜ëŠ” ë° ì‚¬ìš©

- CORS: HTTP ìš”ì²­ í—¤ë”ì™€ ì‘ë‹µ í—¤ë”ë¥¼ í†µí•´ ì‘ë™í•˜ë©°, ë¸Œë¼ìš°ì €ì™€ ì„œë²„ ê°„ì˜ ìƒí˜¸ì‘ìš©ì— ì˜í–¥
- SameSite: ì¿ í‚¤ì˜ ì†ì„±ìœ¼ë¡œ ì‘ë™í•˜ë©°, íŠ¹ì • ì¡°ê±´ì—ì„œ ì¿ í‚¤ê°€ ì „ì†¡ë˜ëŠ” ë°©ì‹ì„ ì œí•œ

ë‘ ë©”ì»¤ë‹ˆì¦˜ ëª¨ë‘ ë‹¤ë¥¸ ì¶œì²˜ ê°„ì˜ ìƒí˜¸ì‘ìš©ì„ ì œì–´í•˜ì—¬ ë³´ì•ˆì„ ê°•í™”í•˜ì§€ë§Œ, ê°ê¸° ë‹¤ë¥¸ ë ˆë²¨ì—ì„œ ì‘ë™í•œë‹¤.
CORSëŠ” ì„œë²„ ì¸¡ ì„¤ì •ì„ í†µí•´ í´ë¼ì´ì–¸íŠ¸ì˜ ìš”ì²­ì„ í—ˆìš© ë˜ëŠ” ê±°ë¶€í•˜ëŠ” ì—­í• ì„ í•˜ë©°, ì£¼ë¡œ API í˜¸ì¶œê³¼ ê°™ì€
HTTP ìš”ì²­ì— ì ìš©ëœë‹¤. SameSiteëŠ” í´ë¼ì´ì–¸íŠ¸ ì¸¡ì—ì„œ ì¿ í‚¤ì˜ ì „ì†¡ì„ ì œì–´í•˜ì—¬ íŠ¹ì • ìƒí™©ì—ì„œì˜ ë³´ì•ˆì„
ê°•í™”í•©ë‹ˆë‹¤.

### ì˜ˆì‹œë¡œ ë³¸ ê´€ê³„

ì›¹ ì• í”Œë¦¬ì¼€ì´ì…˜ì´ https://example.com ë„ë©”ì¸ì— ìˆê³ , ì´ ì• í”Œë¦¬ì¼€ì´ì…˜ì´
https://api.example.comì—ì„œ ìì›ì„ ìš”ì²­í•œë‹¤ê³  ê°€ì •í•œë‹¤.

#### CORS ì„¤ì •

https://api.example.com ì„œë²„ëŠ” https://example.comì—ì„œ ì˜¤ëŠ” ìš”ì²­ì„ í—ˆìš©í•˜ë„ë¡ CORS í—¤ë”ë¥¼
ì„¤ì •í•œë‹¤.

```shell
Access-Control-Allow-Origin: https://example.com
```

#### SameSite ì„¤ì •

https://example.comì—ì„œ ì‚¬ìš©ë˜ëŠ” ì¿ í‚¤ëŠ” SameSite=Lax ë˜ëŠ” SameSite=None; Secure ì†ì„±ì„
í†µí•´ í¬ë¡œìŠ¤ì‚¬ì´íŠ¸ ìš”ì²­ì—ë„ í¬í•¨ë  ìˆ˜ ìˆê²Œ ì„¤ì •í•  ìˆ˜ ìˆë‹¤.

```shell
Set-Cookie: sessionId=abc123; SameSite=None; Secure
```

ì´ì²˜ëŸ¼ CORSëŠ” ì„œë²„ ê°„ì˜ HTTP ìš”ì²­ì„ ì œì–´í•˜ê³ , SameSiteëŠ” í´ë¼ì´ì–¸íŠ¸ ì¸¡ì—ì„œ ì¿ í‚¤ì˜ í¬í•¨ ì—¬ë¶€ë¥¼
ì œì–´í•˜ì—¬, ë‘˜ ë‹¤ ì›¹ ì• í”Œë¦¬ì¼€ì´ì…˜ì˜ ë³´ì•ˆì„ ê°•í™”í•˜ëŠ” ì¤‘ìš”í•œ ì—­í• ì„ í•œë‹¤.

### Preflight requests

ì›¹ ì• í”Œë¦¬ì¼€ì´ì…˜ì—ì„œ CORS (Cross-Origin Resource Sharing)ë¥¼ ì‚¬ìš©í•  ë•Œ, ë¸Œë¼ìš°ì €ê°€ ì‹¤ì œ ìš”ì²­ì„
ë³´ë‚´ê¸° ì „ì— ì„œë²„ê°€ í•´ë‹¹ ìš”ì²­ì„ í—ˆìš©í•˜ëŠ”ì§€ í™•ì¸í•˜ê¸° ìœ„í•´ ë³´ë‚´ëŠ” HTTP ìš”ì²­ì´ë‹¤. ì´ëŠ” ë³´ì•ˆ ëª©ì ìœ¼ë¡œ íŠ¹ì •í•œ
ì¡°ê±´ì„ ë§Œì¡±í•˜ëŠ” í¬ë¡œìŠ¤ ë„ë©”ì¸ ìš”ì²­ì— ëŒ€í•´ ë¸Œë¼ìš°ì €ê°€ ìë™ìœ¼ë¡œ ìˆ˜í–‰í•©ë‹ˆë‹¤.

> ğŸ“š Preflight ìš”ì²­ì´ í•„ìš”í•œ ê²½ìš°
>
> - ì»¤ìŠ¤í…€ í—¤ë” ì‚¬ìš©: Authorizationê³¼ ê°™ì€ í‘œì¤€ í—¤ë” ì™¸ì— ì»¤ìŠ¤í…€ í—¤ë”ë¥¼ ì‚¬ìš©í•˜ëŠ” ê²½ìš°.
> - ë¹„í‘œì¤€ ë©”ì„œë“œ ì‚¬ìš©: GET, POST ì™¸ì˜ ë©”ì„œë“œ(PUT, DELETE ë“±)ë¥¼ ì‚¬ìš©í•˜ëŠ” ê²½ìš°.
> - Content-Typeì´ application/x-www-form-urlencoded, multipart/form-data,
>   text/plainê°€ ì•„ë‹Œ ê²½ìš°: ì˜ˆë¥¼ ë“¤ì–´, application/jsonì„ ì‚¬ìš©í•˜ëŠ” ê²½ìš°.

#### Preflight ìš”ì²­ì˜ ëª©ì 

- ì„œë²„ì˜ í—ˆìš© ì—¬ë¶€ í™•ì¸: ë¸Œë¼ìš°ì €ê°€ íŠ¹ì • ì¶œì²˜ì—ì„œ ì˜¤ëŠ” ìš”ì²­ì´ í—ˆìš©ë˜ëŠ”ì§€ í™•ì¸
- HTTP ë©”ì„œë“œ ë° í—¤ë” í™•ì¸: ìš”ì²­ì— ì‚¬ìš©ëœ HTTP ë©”ì„œë“œì™€ í—¤ë”ê°€ í—ˆìš©ë˜ëŠ”ì§€ í™•ì¸
- ë³´ì•ˆ ê°•í™”: ë¯¼ê°í•œ ìš”ì²­ì´ ì˜ë„ì¹˜ ì•Šê²Œ ì„œë²„ë¡œ ì „ì†¡ë˜ì§€ ì•Šë„ë¡ ë³´ì¥

#### Preflight ìš”ì²­ì˜ ë™ì‘ ë°©ì‹

- OPTIONS ë©”ì„œë“œ ì‚¬ìš©: Preflight ìš”ì²­ì€ í•­ìƒ HTTP OPTIONS ë©”ì„œë“œë¥¼ ì‚¬ìš©
- CORS í—¤ë” í¬í•¨:
  - ë¸Œë¼ìš°ì €ëŠ” ìš”ì²­ì— Origin, Access-Control-Request-Method,
    Access-Control-Request-Headers ë“±ì˜ í—¤ë”ë¥¼ í¬í•¨í•œë‹¤.

í´ë¼ì´ì–¸íŠ¸ ìš”ì²­

```js
fetch('https://api.example.com/data', {
  method: 'POST',
  headers: {
    'Content-Type': 'application/json',
    'X-Custom-Header': 'value',
  },
  body: JSON.stringify({ key: 'value' }),
});
```

Preflight ìš”ì²­ - ë¸Œë¼ìš°ì €ëŠ” ìœ„ì˜ ìš”ì²­ì„ ë³´ë‚´ê¸° ì „ì— ë‹¤ìŒê³¼ ê°™ì€ Preflight ìš”ì²­ì„ ë³´ë‚¸ë‹¤.

```js
OPTIONS /data HTTP/1.1
Host: api.example.com
Origin: https://example.com
Access-Control-Request-Method: POST
Access-Control-Request-Headers: Content-Type, X-Custom-Header
```

ì„œë²„ ì‘ë‹µ - ì„œë²„ëŠ” ë‹¤ìŒê³¼ ê°™ì´ ì‘ë‹µí•  ìˆ˜ ìˆë‹¤.

```js
HTTP/1.1 204 No Content
Access-Control-Allow-Origin: https://example.com
Access-Control-Allow-Methods: POST
Access-Control-Allow-Headers: Content-Type, X-Custom-Header
Access-Control-Max-Age: 86400
```

#### Preflight ìš”ì²­ ìµœì í™”

```shell
Access-Control-Max-Age: 86400
```

- ì´ í—¤ë”ë¥¼ ì‚¬ìš©í•˜ì—¬ Preflight ìš”ì²­ì˜ ì‘ë‹µì„ ìºì‹œí•  ìˆ˜ ìˆë‹¤.
- ì´ë ‡ê²Œ í•˜ë©´ ë™ì¼í•œ ìš”ì²­ì— ëŒ€í•´ ë°˜ë³µì ì¸ Preflight ìš”ì²­ì„ í”¼í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
