# ğŸš€ ë„ì»¤ ë¡œê·¸ ì •ë¦¬í•˜ê¸°

ê°œë°œì„œë²„ì— ì•±ì´ ë„ì»¤ ì»¨í…Œì´ë„ˆë¡œ ë– ìˆëŠ” ê²½ìš°, ë„ì»¤ ìì²´ì ìœ¼ë¡œ ë¡œê·¸ íŒŒì¼ì´ ìŒ“ì…ë‹ˆë‹¤.
ì •ë¦¬í•˜ì§€ ì•Šìœ¼ë©´ ë¹„ëŒ€í•´ì ¸ì„œ ì„œë²„ì˜ ìš©ëŸ‰ ë¬¸ì œë¡œ ì„œë²„ê°€ ë©ˆì¶œ ê°€ëŠ¥ì„±ë„ ìˆìŠµë‹ˆë‹¤.

## í™•ì¸í•˜ì

```shell
docker logs <container-name>
```

ìœ„ì˜ ëª…ë ¹ìœ¼ë¡œ ë‚˜ì˜¤ëŠ” ë¡œê·¸ëŠ” ë³´í†µ ì• í”Œë¦¬ì¼€ì´ì…˜ì˜ í‘œì¤€ ì¶œë ¥(stdout), ì¦‰ ì»¨í…Œì´ë„ˆ ë‚´ë¶€ì—ì„œ ì‹¤í–‰ë˜ëŠ”
í”„ë¡œì„¸ìŠ¤ì˜ ì½˜ì†” ë¡œê·¸ì…ë‹ˆë‹¤.

ì´ê±´ ë‚´ë¶€ì ìœ¼ë¡œ Docker ì—”ì§„ì˜ ë¡œê¹… ë“œë¼ì´ë²„(loggging driver)ê°€ ìˆ˜ì§‘í•˜ê³  ì €ì¥í•©ë‹ˆë‹¤.

## ğŸ§© 1. ë¡œê·¸ ì €ì¥ ìœ„ì¹˜

- ê¸°ë³¸ì ìœ¼ë¡œ Docker ëŠ” json-file ë¡œê·¸ ë“œë¼ì´ë²„ë¥¼ ì‚¬ìš©í•©ë‹ˆë‹¤.
- ë”°ë¼ì„œ ë¡œê·¸ëŠ” í˜¸ìŠ¤íŠ¸ OSì˜ ë‹¤ìŒ ê²½ë¡œì— ì €ì¥ë©ë‹ˆë‹¤:

```shell
/var/lib/docker/containers/<ì»¨í…Œì´ë„ˆ_ID>/<ì»¨í…Œì´ë„ˆ_ID>-json.log

# ì˜ˆ:
# /var/lib/docker/containers/0a8bdf1f54b8e6d349b437e6bca6a138aa0b932e8d01a9d75d7c4860d8f30b18/0a8bdf1f54b8e6d349b437e6bca6a138aa0b932e8d01a9d75d7c4860d8f30b18-json.log
```

### ê¸°ë³¸ì ìœ¼ë¡œ /var/lib/docker í´ë”ëŠ” root ê¶Œí•œ

```shell
whoami
sudo su -
```

## 2. ë¡œê·¸ íŒŒì¼ ìš©ëŸ‰ í™•ì¸

```shell
# var/lib/docker/containers ë“¤ì–´ê°€ì„œ í™•ì¸í•˜ê¸°

cd var/lib/docker/containers

drwx--x---  4 root root 4096 Oct 13 10:29 00725743127...
drwx--x---  4 root root 4096 Nov 19 01:39 0190a40e03b...
drwx--x---  4 root root 4096 Nov 19 01:39 12decbe71c2...
drwx--x---  4 root root 4096 Nov 19 01:39 917f4173d29...
```

```shell
# ë¡œê·¸ íŒŒì¼ ìš©ëŸ‰ í™•ì¸í•˜ê¸°

sudo du -h /var/lib/docker/containers/*/*-json.log | sort -h

8.0K	/var/lib/docker/containers/12de.../12de...-json.log
452K	/var/lib/docker/containers/917f.../917f...-json.log
1.2M	/var/lib/docker/containers/0190.../0190...-json.log
```

## ğŸ§¹ 3. ì¼ì‹œì ìœ¼ë¡œ ë¡œê·¸ ì •ë¦¬ (truncate)

```shell
# ì»¨í…Œì´ë„ˆ ID í™•ì¸
docker ps -a

# ë¡œê·¸ íŒŒì¼ ë¹„ìš°ê¸° (ì£¼ì˜: ë‚´ìš© ì™„ì „ ì‚­ì œ)
sudo truncate -s 0 /var/lib/docker/containers/<ì»¨í…Œì´ë„ˆ_ID>/<ì»¨í…Œì´ë„ˆ_ID>-json.log
```

- ì´ë ‡ê²Œ í•˜ë©´ ì»¨í…Œì´ë„ˆëŠ” ê·¸ëŒ€ë¡œ ìœ ì§€ë˜ê³  ë¡œê·¸ë§Œ ì‚­ì œë©ë‹ˆë‹¤.
  - (rm ëŒ€ì‹  truncate -s 0 ë¥¼ ì¨ì•¼ Dockerê°€ íŒŒì¼ í•¸ë“¤ì„ ìœ ì§€í•¨)

## âœ… 4. ì•ìœ¼ë¡œ ë¡œê·¸ê°€ ë„ˆë¬´ ì»¤ì§€ì§€ ì•Šê²Œ ì œí•œ ê±¸ê¸°

- docker run ë˜ëŠ” docker-compose.yml ì— ë¡œê·¸ ì˜µì…˜ ì¶”ê°€

```shell
services:
  app:
    image: ...
    container_name: ...
    ports:
      - "8000:8000"
    logging:
      driver: "json-file"
      options:
        max-size: "10m"      # ë¡œê·¸ íŒŒì¼ ìµœëŒ€ í¬ê¸° (10MB)
        max-file: "5"        # íŒŒì¼ 5ê°œê¹Œì§€ ìˆœí™˜ ë³´ê´€
```

- ì¦‰, ë¡œê·¸ê°€ 10MB ë„˜ìœ¼ë©´ ìƒˆ íŒŒì¼ë¡œ êµì²´ë˜ê³ , 5ê°œê¹Œì§€ë§Œ ìœ ì§€ë©ë‹ˆë‹¤.

## ğŸ” 5 . ë¡œê·¸ ê´€ë¦¬ ê¶Œì¥ ì „ëµ (ìš´ì˜ ì„œë²„ìš©)

- ì§§ê²Œ ë‚¨ê¸°ê¸°: max-size: 10m, max-file: 5 ì •ë„ê°€ ì ë‹¹
- ë³„ë„ ë¡œê·¸ ìˆ˜ì§‘: ì¤‘ìš”í•œ ë¡œê·¸ëŠ” stdout ëŒ€ì‹  logging íŒ¨í‚¤ì§€ë¡œ íŒŒì¼ì— ë‚¨ê¸°ê¸°
- ë¡œí…Œì´ì…˜ ì„¤ì •: /etc/docker/daemon.json ì—ë„ global ì„¤ì • ê°€ëŠ¥
- ì¤‘ì•™ ë¡œê·¸ ê´€ë¦¬: CloudWatch, Loki, Elasticsearch, GCP Logging ì—°ë™ ê°€ëŠ¥

## âš™ï¸ 6. global ì„¤ì • (daemon.json)

```shell
sudo nano /etc/docker/daemon.json
```

```json
{
  "log-driver": "json-file",
  "log-opts": {
    "max-size": "10m",
    "max-file": "5"
  }
}
```

ë„ì»¤ ì¬ì‹œì‘:

```shell
sudo systemctl restart docker
```
