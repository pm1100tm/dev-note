# LRU cache(Least Recently Used)

## ğŸ§ What is caching

ìºì‹±ì€ ë°ì´í„°ë¥¼ ì½ì–´ì˜¤ëŠ”ë° ì‹œê°„ì´ ì˜¤ë˜ ê±¸ë¦¬ê±°ë‚˜, ì‹¤í–‰í•˜ëŠ”ë° ì˜¤ë˜ ê±¸ë¦¬ëŠ” ì—°ì‚°ì˜ ê²°ê³¼ë¥¼ ë¯¸ë¦¬ ê³„ì‚°í•˜ì—¬
í•„ìš”í•  ë•Œ ìµœì´ˆë¡œ í•œë²ˆë§Œ ê³„ì‚°í•˜ì—¬ ì €ì¥í•´ë†“ê³  ì¬ì‚¬ìš©í•˜ëŠ” ê¸°ìˆ ì„ ì˜ë¯¸í•©ë‹ˆë‹¤.

í”„ë¡ íŠ¸ì•¤ë“œì—ì„œëŠ” í´ë¦¬ì´ì–¸íŠ¸ ì»´í“¨í„°ì— ìºì‹œë¥¼ ë‘ê³ , ì´ ìºì‹œì— ì „ì— ë°©ë¬¸í–ˆë˜ ì›¹í˜ì´ì§€ì˜ ë‚´ìš©ì„ ì €ì¥í•´ë†“ê³ 
ë™ì¼í•œ í˜ì´ì§€ë¥¼ ì¬ë°©ë¬¸ì‹œ ì´ ì €ì¥í•´ë†“ì€ ì‚¬ë³¸ì˜ í˜ì´ì§€ë¥¼ ë³´ì—¬ì£¼ëŠ” ë°©ì‹ì„ ì·¨í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

ë°±ì—”ë“œì—ì„œëŠ” í´ë¼ì´ì–¸íŠ¸ì—ì„œ ë°›ì€ ìš”ì²­ì— ëŒ€í•œ ì²˜ë¦¬ ê²°ê³¼ë¥¼ ìºì‹œì— ì €ì¥í•´ë‘ê³ , ë‚˜ì¤‘ì— ë™ì¼í•œ ìš”ì²­ì´ ë“¤ì–´ì™”ì„
ë•Œ, ì €ì¥í•´ë‘” ê²°ê³¼ë¥¼ ê·¸ëŒ€ë¡œ ì‘ë‹µí•©ë‹ˆë‹¤. ì´ë ‡ê²Œ í•˜ì—¬ ì¡°íšŒ ì†ë„ë¥¼ í–¥ìƒì‹œí‚¤ê³ , ì„œë²„ ë‹¨ì˜ ë¶€í•˜ë¥¼ ì¤„ì¼ ìˆ˜
ìˆìŠµë‹ˆë‹¤.

ë„¤íŠ¸ì›Œí¬ì—ì„œëŠ” í”„ë¡ì‹œ ì„œë²„ë‚˜ CDNì„ ëŒ€í‘œì ì¸ ìºì‹± ì‚¬ë¡€ë¡œ ë³¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

## ìºì‹± ì „ëµì´ë€?

ì¼ë°˜ì ìœ¼ë¡œ ìºì‹±ì„ ìœ„í•´ ì‚¬ìš©ë˜ëŠ” ì €ì¥ ë§¤ì²´ëŠ” ê°€ê²©ì´ ë¹„ìŒ‰ë‹ˆë‹¤. ë”°ë¼ì„œ, ì €ì¥ ë©”ì²´ì˜ ìš©ëŸ‰ì„ ì œí•œí•˜ì—¬
ìµœëŒ€í•œ íš¨ê³¼ì ìœ¼ë¡œ ì‚¬ìš©í•˜ëŠ” ì „ëµì„ ì·¨í•©ë‹ˆë‹¤. ì´ê²ƒì„ ìºì‹± ì „ëµì´ë¼ê³  í•©ë‹ˆë‹¤.

ìºì‹± ì „ëµì€ ìºì‹œ ìš©ëŸ‰ì´ ê½‰ ì°¼ì„ ë•Œ, ì–´ë–¤ ë°ì´í„°ë¥¼ ë‚¨ê²¨ë‘ê³ , ì–´ë–¤ ë°ì´í„°ë¥¼ ì§€ì›Œì•¼í• ì§€ì— ëŒ€í•œ ë°©ë²•ì„
ëœ»í•©ë‹ˆë‹¤. ìºì‹± ì „ëµì—ëŠ” ì•„ë˜ì™€ ê°™ì€ ì¢…ë¥˜ê°€ ìˆìŠµë‹ˆë‹¤.

- LRU(Least Recently Used) cache
- MRU(Most Recently Used) cache
- LFU(Least Frequently Used) cache

### ìºì‹± ì „ëµ - LRU cache(Least Recently Used)

ì—¬ê¸°ì„œëŠ” **LRU cache** ì „ëµì— ëŒ€í•´ì„œ ì•Œì•„ë³´ê³ ì í•©ë‹ˆë‹¤.

LRU cache ì „ëµì€ **ìµœê·¼ì— ì‚¬ìš©ëœ ë°ì´í„°ì¼ìˆ˜ë¡ ì•ìœ¼ë¡œë„ ì‚¬ìš©ë  ê°€ëŠ¥ì„±ì´ ë†’ë‹¤**ë¼ëŠ” ê°€ì„¤ì„ ë°”íƒ•ìœ¼ë¡œ
ë§Œë“¤ì–´ì¡ŒìŠµë‹ˆë‹¤. ì´ ì „ëµì€ ê°€ì¥ ì˜¤ë«ë™ì•ˆ ì°¸ì¡°(ì‚¬ìš©)ë˜ì§€ ì•Šì€ ë°ì´í„°ë¥¼ ì‚­ì œí•˜ì—¬ ê³µê°„ì„ í™•ë³´í•˜ê³ , ì¡°íšŒí•œ
ë°ì´í„°ëŠ” ê°€ì¥ ìµœê·¼ì— ì‚¬ìš©ëœ ë°ì´í„°ë¡œ ê°„ì£¼í•©ë‹ˆë‹¤. ë©”ëª¨ë¦¬ê°€ ì œí•œë˜ì–´ìˆê³  ìì£¼ ì—‘ì„¸ìŠ¤í•˜ëŠ” ë°ì´í„°ì— ë¹ ë¥´ê²Œ
ì—‘ì„¸ìŠ¤ í•  ìˆ˜ ìˆì–´ì•¼ í•˜ëŠ” ì‹œë‚˜ë¦¬ì˜¤ì— ìœ ìš©í•©ë‹ˆë‹¤.

LRU cacheì˜ ì„¸ë¶€ ë™ì‘ë°©ì‹ì€ ì•„ë˜ì™€ ê°™ìŠµë‹ˆë‹¤.

- ìƒˆë¡œìš´ ë°ì´í„°ê°€ ì¶”ê°€ë  ê²½ìš°,
  - ìºì‹œì˜ ê³µê°„ì´ ê°€ë“ì°¨ì§€ ì•Šì€ ê²½ìš°, ë°ì´í„°ë¥¼ ê°€ì¥ ìµœê·¼ ìœ„ì¹˜ë¡œ ì´ë™ì‹œí‚µë‹ˆë‹¤.
  - ìºì‹œì˜ ê³µê°„ì´ ê°€ë“ì°¬ ê²½ìš°, ê°€ì¥ ì˜¤ë«ë™ì•ˆ ì‚¬ìš©ë˜ì§€ ì•Šì€ ë°ì´í„°ë¥¼ ì œê±°í•˜ê³ , ìƒˆë¡œìš´ ë°ì´í„°ë¥¼ ê°€ì¥ ìµœê·¼
    ìœ„ì¹˜ë¡œ ì´ë™ì‹œí‚µë‹ˆë‹¤.
- ì´ë¯¸ ì¡´ì¬í•˜ëŠ” ë°ì´í„°ë¥¼ ì¡°íšŒí•  ê²½ìš°,
  - í•´ë‹¹ ë°ì´í„°ë¥¼ ê°€ì¥ ìµœê·¼ ìœ„ì¹˜ë¡œ ì´ë™ì‹œí‚µë‹ˆë‹¤.

> ğŸ“š ìš©ì–´ë„ ì•Œì•„ë‘ë©´ ì¢‹ìŠµë‹ˆë‹¤.
>
> - Cache Hit: ìºì‹œì— ì›í•˜ëŠ” ë°ì´í„°ê°€ ìˆì–´, ë””ìŠ¤í¬ì— ì ‘ê·¼í•˜ì§€ ì•Šê³  ë°ì´í„°ë¥¼ ê°€ì ¸ì˜¤ëŠ” ê²ƒ
> - Cache Miss: ìºì‹œì— ì›í•˜ëŠ” ë°ì´í„°ê°€ ì—†ëŠ” ê²ƒ
> - Eviction: ìºì‹œ ê³µê°„ì´ ê½‰ì°¨ì„œ ë°ì´í„°ë¥¼ ì œê±°í•˜ëŠ” ê²ƒ

### LRU cache ë™ì‘ë°©ì‹ ì•Œì•„ë³´ê¸°

ì•„ë˜ì˜ ì˜ˆì‹œì—ì„œëŠ” ê°€ì¥ ì™¼ìª½ì— ìˆëŠ” ë°ì´í„°ê°€ ê°€ì¥ ìµœì‹ ì— [ì¡°íšŒ/ì‚½ì…] ë°ì´í„°ë¼ê³  ê°€ì •í•©ë‹ˆë‹¤.

```python
# ìºì‹œ í¬ê¸°ê°€ 3ì¸ ì´ˆê¸° ìƒíƒœ
[empty, empty, empty]

# ë°ì´í„° 1 ì ‘ê·¼, ë°ì´í„°ê°€ ì—†ê¸° ë•Œë¬¸ì— 1ì¶”ê°€
[1, empty, empty]

# ë°ì´í„° 2 ì ‘ê·¼, ë°ì´í„°ê°€ ì—†ê¸° ë•Œë¬¸ì— 2ì¶”ê°€, 2 ê°€ì¥ ì²˜ìŒìœ¼ë¡œ
[2, 1, empty]

# ë°ì´í„° 3 ì ‘ê·¼, ë°ì´í„°ê°€ ì—†ê¸° ë•Œë¬¸ì— 3ì¶”ê°€, 3 ê°€ì¥ ì²˜ìŒìœ¼ë¡œ
[3, 2, 1]

# ë°ì´í„° 4 ì ‘ê·¼, 4 ë°ì´í„° ì—†ê¸° ë•Œë¬¸ì— 4ì¶”ê°€, 4 ê°€ì¥ ì²˜ìŒìœ¼ë¡œ, ê°€ì¥ ë§ˆì§€ë§‰ ì›ì†Œ(1) ì œê±°
[4, 3, 2]

# ë°ì´í„° 2 ì ‘ê·¼, ë°ì´í„°ê°€ ìˆê³ , 2 ê°€ì¥ ì²˜ìŒìœ¼ë¡œ
[2, 4, 3]

# ë°ì´í„° 4 ì ‘ê·¼, ë°ì´í„°ê°€ ìˆê³ , 4 ê°€ì¥ ì²˜ìŒìœ¼ë¡œ
[4, 2, 3] # 4ê°€ ê°€ì¥ ìµœê·¼ ì‚¬ìš©ëœ ë°ì´í„°ê°€ ë¨
```

## Pythonì—ì„œ LRU ìºì‹œ ì‚¬ìš©

functools ëª¨ë“ˆì˜ lru_cache ë°ì½”ë ˆì´í„°ë¥¼ ì‚¬ìš©í•˜ì—¬ LRU ìºì‹œë¥¼ ì‰½ê²Œ êµ¬í˜„í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

```python
import random

from functools import lru_cache


def fetch_num(n: int):
    print(f'Fetching num: {n}')
    return n


@lru_cache(maxsize=3)
def get_num(n: int) -> int:
    return fetch_num(n)


def main():
    for _ in range(10):
        get_num(random.randint(0, 10))

    print(get_num.cache_info())


if __name__ == '__main__':
    main()


# Fetching num: 1
# Fetching num: 7
# Fetching num: 2
# Fetching num: 0
# Fetching num: 9
# Fetching num: 5
# CacheInfo(hits=4, misses=6, maxsize=3, currsize=3) << ëœë¤ìœ¼ë¡œ ë³€ê²½ë¨
```

### maxsize ì˜ ì˜ë¯¸

lru_cache ë°ì½”ë ˆì´ì˜ ë§¤ê°œë³€ìˆ˜ maxsizeëŠ” **ìºì‹œì— ì €ì¥í•  ìˆ˜ ìˆëŠ” ìµœëŒ€ í•­ëª© ìˆ˜**ë¥¼ ì§€ì •í•©ë‹ˆë‹¤.
ìºì‹œê°€ ì´ í¬ê¸°ë¥¼ ì´ˆê³¼í•˜ë©´ ìµœê·¼ì— ê°€ì¥ ì ê²Œ ì‚¬ìš©ëœ í•­ëª©ì€ ìƒˆ í•­ëª©ì„ ìœ„í•œ ê³µê°„ì„ í™•ë³´í•˜ê¸° ìœ„í•´ ì œê±°ë©ë‹ˆë‹¤.

ëª…ì‹œì ìœ¼ë¡œ ì§€ì •í•˜ì§€ ì•Šì€ ê²½ìš° maxsizeì˜ ê¸°ë³¸ ê°’ì€ 128ì…ë‹ˆë‹¤.
ì´ ê°’ì„ Noneìœ¼ë¡œ ì„¤ì •í•˜ë©´ ìºì‹œê°€ ì œí•œ ì—†ì´ ì»¤ì§ˆ ìˆ˜ ìˆê¸° ë•Œë¬¸ì— ì£¼ì˜í•´ì•¼í•©ë‹ˆë‹¤.

## LRU ìºì‹œ í´ë˜ìŠ¤ êµ¬í˜„

```python
from collections import OrderedDict


class LRUCache:
    def __init__(self, max_size):
        self.cache = OrderedDict()
        self.max_size = max_size

    def get(self, key):
        if key in self.cache:
            # í‚¤ë¥¼ ê°€ì¥ ìµœê·¼ ì‚¬ìš©ëœ ìƒíƒœë¡œ ê°±ì‹ 
            value = self.cache.pop(key)
            self.cache[key] = value
            return value
        return None

    def put(self, key, value):
        if key in self.cache:
            # ê¸°ì¡´ í‚¤ë¥¼ ì œê±°í•˜ì—¬ ìµœê·¼ ì‚¬ìš©ëœ ìƒíƒœë¡œ ê°±ì‹ 
            self.cache.pop(key)
        elif len(self.cache) >= self.max_size:
            # ìºì‹œê°€ ê°€ë“ ì°¬ ê²½ìš° ê°€ì¥ ì˜¤ë˜ëœ í•­ëª© ì œê±°
            self.cache.popitem(last=False)
        # ìƒˆë¡œìš´ í‚¤-ê°’ ìŒ ì¶”ê°€
        self.cache[key] = value

    def __str__(self):
        return str(self.cache)


max_size = 3  # ìµœëŒ€ í¬ê¸°ë¥¼ 3ìœ¼ë¡œ ì„¤ì •
lru_cache = LRUCache(max_size)

lru_cache.put("a", "apple")
lru_cache.put("b", "banana")
lru_cache.put("c", "cherry")

print(lru_cache) # ì¶œë ¥: OrderedDict([('a', 'apple'), ('b', 'banana'), ('c', 'cherry')])

# ì ‘ê·¼í•˜ì—¬ 'a'ë¥¼ ìµœì‹  ìƒíƒœë¡œ ê°±ì‹ 
print(lru_cache.get("a"))  # ì¶œë ¥: apple
print(lru_cache)  # ì¶œë ¥: OrderedDict([('b', 'banana'), ('c', 'cherry'), ('a', 'apple')])

# ìƒˆë¡œìš´ í•­ëª© ì¶”ê°€ë¡œ ì¸í•´ ê°€ì¥ ì˜¤ë˜ëœ 'b'ê°€ ì œê±°ë¨
lru_cache.put("d", "durian")
print(lru_cache)  # ì¶œë ¥: OrderedDict([('c', 'cherry'), ('a', 'apple'), ('d', 'durian')])

# ì¡´ì¬í•˜ì§€ ì•ŠëŠ” í‚¤ ì ‘ê·¼ ì‹œ None ë°˜í™˜
print(lru_cache.get("b"))  # ì¶œë ¥: None
print(lru_cache)  # ì¶œë ¥: OrderedDict([('c', 'cherry'), ('a', 'apple'), ('d', 'durian')])

max_size = 3  # ìµœëŒ€ í¬ê¸°ë¥¼ 3ìœ¼ë¡œ ì„¤ì •
lru_cache = LRUCache(max_size)

lru_cache.put("a", "apple")
lru_cache.put("b", "banana")
lru_cache.put("c", "cherry")

print(lru_cache)  # ì¶œë ¥: OrderedDict([('a', 'apple'), ('b', 'banana'), ('c', 'cherry')])

# ì ‘ê·¼í•˜ì—¬ 'a'ë¥¼ ìµœì‹  ìƒíƒœë¡œ ê°±ì‹ 
print(lru_cache.get("a"))  # ì¶œë ¥: apple
print(lru_cache)  # ì¶œë ¥: OrderedDict([('b', 'banana'), ('c', 'cherry'), ('a', 'apple')])

# ìƒˆë¡œìš´ í•­ëª© ì¶”ê°€ë¡œ ì¸í•´ ê°€ì¥ ì˜¤ë˜ëœ 'b'ê°€ ì œê±°ë¨
lru_cache.put("d", "durian")
print(lru_cache)  # ì¶œë ¥: OrderedDict([('c', 'cherry'), ('a', 'apple'), ('d', 'durian')])

# ì¡´ì¬í•˜ì§€ ì•ŠëŠ” í‚¤ ì ‘ê·¼ ì‹œ None ë°˜í™˜
print(lru_cache.get("b"))  # ì¶œë ¥: None
print(lru_cache)  # ì¶œë ¥: OrderedDict([('c', 'cherry'), ('a', 'apple'), ('d', 'durian')])


# LRUCache í´ë˜ìŠ¤
- __init__(self, max_size): ìµœëŒ€ ìºì‹œ í¬ê¸°ë¥¼ ì„¤ì •í•˜ëŠ” ìƒì„±ìì…ë‹ˆë‹¤.
- get(self, key): í‚¤ë¥¼ ì‚¬ìš©í•˜ì—¬ ê°’ì„ ê°€ì ¸ì˜µë‹ˆë‹¤. í‚¤ê°€ ì¡´ì¬í•˜ë©´ ê°€ì¥ ìµœê·¼ ì‚¬ìš©ëœ ìƒíƒœë¡œ ê°±ì‹ í•©ë‹ˆë‹¤.
- put(self, key, value): í‚¤-ê°’ ìŒì„ ìºì‹œì— ì¶”ê°€í•©ë‹ˆë‹¤. ìºì‹œê°€ ê°€ë“ ì°¨ë©´ ê°€ì¥ ì˜¤ë˜ëœ í•­ëª©ì„ ì œê±°í•©ë‹ˆë‹¤.
- __str__(self): ìºì‹œì˜ í˜„ì¬ ìƒíƒœë¥¼ ë¬¸ìì—´ë¡œ ë°˜í™˜í•©ë‹ˆë‹¤.

- put ë©”ì„œë“œë¥¼ í†µí•´ ìºì‹œì— ë¬¸ìì—´ ê°’ì„ ì €ì¥í•©ë‹ˆë‹¤.
- get ë©”ì„œë“œë¥¼ í†µí•´ ìºì‹œì—ì„œ ê°’ì„ ê°€ì ¸ì˜¤ê³ , ìµœê·¼ ì‚¬ìš©ëœ ìƒíƒœë¡œ ê°±ì‹ í•©ë‹ˆë‹¤.
- ìºì‹œê°€ ê°€ë“ ì°¬ ìƒíƒœì—ì„œ ìƒˆë¡œìš´ ê°’ì„ ì¶”ê°€í•˜ë©´ ê°€ì¥ ì˜¤ë˜ëœ í•­ëª©ì´ ì œê±°ë©ë‹ˆë‹¤.
```
