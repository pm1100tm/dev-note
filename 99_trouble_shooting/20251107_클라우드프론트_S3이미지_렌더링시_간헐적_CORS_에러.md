# 클라우드프론트 S3이미지 렌더링시 간헐적 CORS 에러

## 🚨 가능한 주요 원인 정리

| 구분   | 가능 원인                                    | 상세 설명                                                                                                          | 확인/조치 포인트                                                               |
| ------ | -------------------------------------------- | ------------------------------------------------------------------------------------------------------------------ | ------------------------------------------------------------------------------ |
| **1️⃣** | **S3 CORS 정책 불일치**                      | CloudFront가 S3 Origin에 요청 시 CORS 응답 헤더(`Access-Control-Allow-Origin`)이 누락되거나 제한되어 있는 경우     | S3 버킷의 CORS 설정(JSON) 확인                                                 |
| **2️⃣** | **CloudFront 캐시 불균형**                   | CloudFront가 S3의 응답(CORS 헤더 포함)을 캐싱했다가, 일부 엣지 로케이션에서 CORS 헤더 없는 캐시 응답을 보내는 경우 | CloudFront 캐시 무효화 또는 Origin Request Policy/Response Headers Policy 점검 |
| **3️⃣** | **서버 응답 헤더 누락**                      | 일부 파일(S3 객체)에 메타데이터(CORS 관련 헤더)가 누락되어 있는 경우                                               | S3 객체의 Metadata 확인 (특히 `Content-Type`, `Access-Control-Allow-Origin`)   |
| **4️⃣** | **Signed URL / Expired Cache 이슈**          | CloudFront나 S3에서 일시적으로 URL 만료 혹은 미완료 전파 상태인 경우                                               | CloudFront 로그 또는 CloudWatch 로그 확인                                      |
| **5️⃣** | **브라우저 캐시 불일치**                     | 사용자의 브라우저가 이전 캐시된 OPTIONS 프리플라이트 응답을 잘못 사용하는 경우                                     | 브라우저 개발자도구에서 Network → OPTIONS 요청/응답 헤더 확인                  |
| **6️⃣** | **CloudFront Response Header Policy 미적용** | CloudFront 배포에 `Access-Control-Allow-Origin` 헤더 추가 정책이 설정되어 있지 않거나, 일부 경로에만 적용          | CloudFront → Behavior → Response Headers Policy 확인                           |
