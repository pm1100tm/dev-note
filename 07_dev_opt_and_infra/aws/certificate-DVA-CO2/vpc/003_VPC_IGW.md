# π€ VPC IGW(Internet Gateway)

- VPCκ°€ μΈν„°λ„·κ³Ό ν†µμ‹ ν•  μ μλ„λ΅ ν•΄μ£Όλ” κ΄€λ¬Έ(Gateway)

  - β€VPCλ¥Ό μ™Έλ¶€ μΈν„°λ„·κ³Ό μ—°κ²°ν•λ” λ¬Έβ€ μ΄λΌκ³  μ΄ν•΄ν•λ©΄ λ¨.

- IGWλ” VPCμ— 1κ°λ§ μ—°κ²° κ°€λ¥
  - (ν•„μ”ν•λ©΄ λ‹¤λ¥Έ IGWλ΅ κµμ²΄ν•  μλ” μμ§€λ§, λ™μ‹μ— μ—¬λ¬ κ°λ” λ¶κ°€λ¥)

<br>

## π§­ IGWκ°€ ν•λ” μ—­ν• 

### 1. Public Subnetμ΄ μΈν„°λ„·μ—μ„ μ ‘κ·Ό κ°€λ¥ν•λ„λ΅ ν•΄μ¤

Public Subnetμ Route Tableμ—μ„ λ‹¤μ λΌμ°ν…μ΄ μμ–΄μ•Ό ν•¨:

```shell
0.0.0.0/0 β†’ Internet Gateway
```

- β†’ Public Subnetμ EC2λ” μ™Έλ¶€μ—μ„ λ°”λ΅ μ ‘μ† κ°€λ¥
- β†’ λ°λ€λ΅ Private Subnetμ—λ” μ΄ κ²½λ΅κ°€ μ—†μ

### 2. μ–‘λ°©ν–¥ μΈν„°λ„· ν†µμ‹  μ§€μ›

EC2κ°€ μΈν„°λ„·μΌλ΅ λ‚κ°€κ³ (OUTBOUND), λ“¤μ–΄μ¤λ”(INBOUND) λ¨λ“  νΈλν”½μ€ IGWλ¥Ό μ§€λ‚κ°.

```shell
User β†” IGW β†” Public Subnet EC2

# EC2κ°€ μΈν„°λ„·μΌλ΅ λ‚κ° λ• β†’ Outbound νΈλν”½μ΄ IGWλ¥Ό ν†µκ³Όν•¨
# μΈν„°λ„·μ—μ„ EC2λ΅ λ“¤μ–΄μ¬ λ• β†’ Inbound νΈλν”½ μ—­μ‹ IGWλ¥Ό ν†µκ³Όν•¨
```

SSL, HTTP, SSH λ“± λ¨λ“  ν†µμ‹ μ΄ μ΄ κ²½λ΅λ¥Ό μ΄μ©ν•¨.

### 3. Public IPκ°€ μμ–΄μ•Όλ§ μΈν„°λ„· ν†µμ‹  κ°€λ¥

- EC2κ°€ Public Subnetμ— μμ–΄λ„ Public IP λλ” Elastic IPκ°€ μ—†λ‹¤λ©΄ μΈν„°λ„· ν†µμ‹  λ¶κ°€
- IGWλ” NAT μ—­ν• μ„ ν•μ§€ μ•μ β†’ νλ“μ²λΌ μλ™ IP λ³€ν™ μ—†μ
- ν΄λΌμ΄μ–ΈνΈκ°€ μ™Έλ¶€μ—μ„ μ ‘μ†ν•  μ μλ„λ΅ Public IPκ°€ λ°λ“μ‹ ν•„μ”ν•¨

<br>

## β™οΈ IGW ν•„μ μ΅°κ±΄ μ²΄ν¬

| μ΅°κ±΄                              | ν•„μ” μ—¬λ¶€ |
| --------------------------------- | --------- |
| **Subnet Route Tableμ— IGW μ§€μ •** | β… ν•„μ   |
| **EC2μ— Public IP**               | β… ν•„μ   |
| **Security Group Inbound ν—μ©**   | ν•„μ”      |
| **NACL ν—μ©**                     | ν•„μ”      |

---

## π― ν• μ¤„ μ”μ•½

- VPC/Subnet = AWS λ‚΄λ¶€ λ„¤νΈμ›ν¬ κµ¬μ΅°μ λΌλ€
- Internet Gateway(IGW) = κ³µμ© μΈν„°λ„·κ³Ό ν†µμ‹ ν•λ” λ¬Έ(κ²μ΄νΈμ›¨μ΄)
- Public Subnetμ€ IGW κ²½λ΅κ°€ μμ–΄μ•Ό ν•κ³ , EC2λ” Public IPκ°€ μμ–΄μ•Ό μΈν„°λ„·μ΄ μ—΄λ¦°λ‹¤.

<br>

![vpc diragram](./assets/vpc_002_nat_gateway.png)

---

## Q. Private Subnet μ—μ„ NAT λ¥Ό ν†µν•΄μ„ Outbound λ§ κ°€λ¥ν• μ‹¤λ¬΄μ μΈ μμ‹

### π§‘β€π’» 1. App Server(EC2)κ°€ ν¨ν‚¤μ§€ μ„¤μΉ/μ—…λ°μ΄νΈ ν•΄μ•Ό ν•  λ•

- Private Subnetμ— μλ” EC2λ” μΈν„°λ„·μ— λ°”λ΅ λ‚κ° μ μ—†μ
  - β†’ ν•μ§€λ§ μ„λ²„λ” OS μ—…λ°μ΄νΈ, ν¨ν‚¤μ§€ μ„¤μΉ λ“± μ™Έλ¶€ λ¦¬ν¬μ§€ν† λ¦¬μ— μ ‘κ·Όν•΄μ•Ό ν•¨

```shell
sudo apt update
sudo apt install python3-pip
pip install boto3
```

### π§  2. App μ„λ²„κ°€ μ™Έλ¶€ API νΈμ¶μ΄ ν•„μ”ν•  λ•

μ:

- μ™Έλ¶€ κ²°μ  API (KakaoPay, Toss)
- μ™Έλ¶€ SMS API (Naver Cloud, Twilio)
- μ™Έλ¶€ μ§€λ„ API (Google Maps)
- μ™Έλ¶€ μΈμ¦ API (Google OAuth, Apple OAuth)
- μ™Έλ¶€ μ›Ήν›… νΈμ¶

Private App Serverκ°€ μ΄λ° APIλ΅ λ‚κ°€λ ¤λ©΄ Outbound μΈν„°λ„·μ΄ ν•„μ”ν•¨.

```shell
App Server (Private Subnet)
       β†“ (NAT GW)
Internet
       β†“
KakaoPay API
```

ν•μ§€λ§ μ™Έλ¶€μ—μ„ μ°λ¦¬ μ„λ²„λ΅λ” λ“¤μ–΄μ¬ μ μ—†μ β†’ secure!

```shell
                 β”β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”
                 β”‚      Internet        β”‚
                 β””β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β–²β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”
                             β”‚ (Inbound)
                             β”‚
                     β”β”€β”€β”€β”€β”€β”€β”€β”΄β”€β”€β”€β”€β”€β”€β”€β”€β”
                     β”‚      IGW        β”‚
                     β””β”€β”€β”€β”€β”€β”€β”€β–Όβ”€β”€β”€β”€β”€β”€β”€β”€β”
                            (Inbound/Outbound)
                  β”β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”
                  β”‚     Public Subnet         β”‚
                  β””β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”
                     β”‚             β–²
         (SG Inbound ν—μ©) β”‚             β”‚ (SG Outbound μλ™ ν—μ©)
                     β–Ό             β”‚
               β”β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”
               β”‚        EC2 (Public)     β”‚
               β””β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”


               β”β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”
               β”‚      Private Subnet      β”‚
               β””β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”
                     β”‚
                     β–Ό (Outboundλ§ κ°€λ¥)
              β”β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”
              β”‚       NAT Gateway        β”‚
              β””β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”
                     β”‚
                     β–Ό
                 Internet
```
