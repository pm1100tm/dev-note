# 🚀 AWS Elastic Cache

Amazon ElastiCache는 Redis 또는 Memcached를 완전관리형(Managed)으로 제공하는
인메모리 캐싱(In-memory Caching) 서비스입니다.

데이터베이스처럼 스토리지에 데이터를 저장하는 대신, RAM 메모리 위에 데이터를 보관하여 매우 빠른 조회
속도를 제공합니다.

## 개념 요약

- 서비스 유형: 완전관리형 인메모리 캐시 서비스
- 지원 엔진: ✅ Redis, ✅ Memcached
- 특징: 초저지연(마이크로초 단위), 고성능 읽기/쓰기
- 사용 목적: DB 읽기 부하 감소, 세션 캐싱, 임시 데이터 저장
- 관리 항목: AWS가 OS 패치, 백업, 복구, 모니터링 모두 관리
- 애플리케이션 영향: 캐시 로직을 코드에 직접 추가해야 함 (코드 변경 多)

> ElastiCache 의 역할
>
> 💬 “RDS가 DB를 관리해주듯, ElastiCache는 Redis/Memcached 캐시를 관리해준다.”

### 🚀 주요 장점

- ⚡ 초고속 응답속도: 데이터가 RAM에 있어 마이크로초 단위 응답
- 💾 DB 부하 감소: 읽기 요청을 캐시로 대체
- 🔁 자동 관리: AWS가 패치, 복제, 장애조치 자동 수행
- 🧱 Stateless 아키텍처 지원: 세션/임시 데이터를 캐시에 저장하여 앱 서버 간 상태 공유
- 🛡️ 보안 통합: VPC, IAM, KMS 암호화, TLS 전송 등 지원

### 🔧 주요 사용 사례

- 🔹 데이터 캐싱: DB에서 자주 조회되는 데이터를 Redis에 저장
- 🔹 세션 스토어(Session Store): 로그인/사용자 세션 상태를 캐시에 저장 (Stateless 앱 구현)
- 🔹 리더보드 / 실시간 랭킹: 실시간 점수, 카운트, 인기순위 관리
- 🔹 큐잉/메시지 버퍼: Redis Pub/Sub 또는 Streams 사용
- 🔹 임시 데이터 저장: TTL(Time-To-Live) 설정으로 자동 만료 처리 가능

## 🧰 AWS가 관리해주는 것들

- **OS 유지보수 / 패치**
- **백업 및 복구**
- **장애 조치 / 노드 교체**
- **모니터링 / 알람 (CloudWatch)**
- **스케일링**
- **보안 설정 (VPC, KMS, TLS 등)**

---

## 질문 몇 가지

### Q. 🆚 Redis vs Memcached

| 항목                     | Redis                                  | Memcached      |
| ------------------------ | -------------------------------------- | -------------- |
| **데이터 구조**          | Key-Value + List, Set, Hash, SortedSet | 단순 Key-Value |
| **영속성 (Persistence)** | ✅ 지원 (RDB, AOF)                     | ❌ 없음        |
| **복제 (Replication)**   | ✅ 지원                                | ❌ 없음        |
| **클러스터링**           | ✅ 지원                                | ✅ 지원        |
| **Pub/Sub**              | ✅ 지원                                | ❌ 없음        |
| **트랜잭션**             | ✅ 지원                                | ❌ 없음        |
| **TTL 지원**             | ✅ 지원                                | ✅ 지원        |

#### **RDB** Redis DataBase Snapshot

- 일정 시점의 전체 메모리 상태를 스냅샷(snapshot) 으로 저장 👉 **_dump.rdb_**
- 저장 시점: Periodic
- 서버가 재시작될 때, 이 파일을 읽어서 메모리 상태를 복구합니다.

예시 설정 (redis.conf):

```shell
save 900 1     # 900초(15분) 동안 1개 이상 키 변경 시 저장
save 300 10    # 5분 동안 10개 이상 변경 시 저장
save 60 10000  # 1분 동안 10,000개 이상 변경 시 저장
```

#### **AOF** Append Only File

- Redis의 모든 쓰기 명령(SET, LPUSH, INCR 등) 을 로그 형태로 누적 기록
- 실시간 (Append-only)
  - “모든 쓰기 명령을 순서대로 파일에 기록한다.”
- 재시작 시 이 파일을 순차 실행하여 메모리 상태를 완전히 복원

| 항목                 | 내용                           |
| -------------------- | ------------------------------ |
| **저장 방식**        | 모든 쓰기 명령을 append로 기록 |
| **파일 이름**        | appendonly.aof                 |
| **데이터 손실 위험** | 매우 낮음 (거의 실시간 저장)   |
| **파일 크기**        | 점점 커짐 (주기적 압축 필요)   |
| **복구 속도**        | 느림 (모든 명령 재실행)        |
| **장점**             | 데이터 유실 최소화             |
| **단점**             | I/O 부하 증가, 파일 커짐       |

예시 설정 (redis.conf):

```shell
appendonly yes
appendfsync everysec   # 매초 파일에 동기화 (성능/안정성 밸런스)
```

#### Redis 에서는 RDB + AOF를 함께 사용 가능

- 평상시에는 RDB 스냅샷으로 주기적 백업
- 장애 발생 직전의 데이터는 AOF 로그로 복구
- ✅ 실제 운영환경에서는 “RDB + AOF 동시 사용”이 일반적입니다.

Redis는 이 두 방식을 통해, 인메모리 DB이면서도 데이터 영속성(Persistence)을 보장할 수 있습니다.

### Q. Docker Redis vs AWS ElastiCache 비교

| 구분                   | Docker로 Redis 직접 운영            | AWS ElastiCache (Managed Redis)          |
| ---------------------- | ----------------------------------- | ---------------------------------------- |
| **관리 주체**          | 👩‍💻 사용자가 직접 관리               | ☁️ AWS가 완전관리 (Managed Service)      |
| **설치 방식**          | Docker 이미지 실행 (`redis:latest`) | 콘솔/CLI로 ElastiCache 클러스터 생성     |
| **서버 관리**          | 직접 OS/패치/보안/재시작 관리       | AWS가 자동으로 관리                      |
| **고가용성 (HA)**      | 직접 Sentinel/Cluster 구성 필요     | 기본 Multi-AZ 지원 + 자동 Failover       |
| **확장성 (Scaling)**   | 수동으로 컨테이너 추가              | AWS에서 버튼 클릭으로 자동 스케일링      |
| **백업/복구**          | 직접 `redis-cli`로 `dump.rdb` 관리  | Snapshot 자동 백업, 복원 클릭만으로 가능 |
| **모니터링**           | Prometheus, Grafana 직접 설정       | CloudWatch, Event 알람 자동 연동         |
| **보안/네트워크**      | 직접 포트 개방 (6379), 방화벽 설정  | VPC Security Group 기반 제어, IAM 통합   |
| **성능 최적화**        | 컨테이너 CPU/RAM 제한 직접 조정     | AWS 인스턴스 타입 기반 자동 최적화       |
| **Persistence**        | RDB/AOF 직접 설정                   | AWS가 관리형으로 설정 및 보관            |
| **업데이트/패치**      | 수동 재배포 필요                    | AWS가 무중단으로 자동 패치 가능          |
| **비용 구조**          | EC2 or 로컬 서버 비용 + 관리 시간   | ElastiCache 인스턴스 시간당 과금         |
| **실험/개발 용도**     | ✅ 간편 (로컬 개발/테스트용)        | ❌ 오버스펙 (운영환경용)                 |
| **운영/프로덕션 용도** | ❌ 위험 (장애 대응, HA 없음)        | ✅ 안정적 (자동 Failover, 관리형)        |
