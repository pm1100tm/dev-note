# 🚀 DDD 이론 2: 유비쿼터스 언어

🔥 핵심 키워드

- 1. 유비쿼터스 언어란 무엇인가
- 2. 왜 유비쿼터스 언어가 필요한가
- 3. 언어 불일치의 실제 비용
- 4. 유비쿼터스 언어 구축하기
- 5. 코드에서의 유비쿼터스 언어
- 6. 유비쿼터스 언어 유지와 진화
- 7. 실제 사례와 안티패턴
- 8. 실습 워크숍: 유비쿼터스 언어 구축
- 9. Bounded Context와 유비쿼터스 언어
- 10. 실제 기업 사례 연구

---

## Q&A

📚 목차

- 1. ACL 이란?
- 2. ACL은 어느 레이어에 두는가?

<br>

### 1. ACL 이란?

- ACL = Anti-Corruption Layer (오염 방지 계층)
- “팀 간 통합 시 번역 계층(ACL) 필요” 는 Anti-Corruption Layer를 말하는 게 100% 확실하다.

#### 🧠 Anti-Corruption Layer란?

한 문장 정의

- 외부 시스템(다른 팀의 모델)이 내 도메인을 오염시키지 않도록 막는 번역 계층

#### 🎯 왜 “오염(Corruption)”이라는 표현을 쓰나?

- 다른 팀 / 레거시 시스템
- 다른 용어(Ubiquitous Language 불일치)
- 다른 모델 구조
- 다른 비즈니스 규칙

```shell
외부 모델 → 내부 도메인 직접 침투 ❌

- 서로 다른 도메인에서 '주문' 이라는 용어가 쓰임
- 빠른 성장으로 개발팀이 급격히 확대
- 각 팀이 독자적인 용어를 사용하기 시작. "주문"이 팀마다 다른 의미로 사용됨.

• 주문팀: 주문 = 결제 전 장바구니 확정
• 결제팀: 주문 = 결제 완료된 거래
• 배송팀: 주문 = 출고 요청 건
• 통합 시 데이터 불일치로 대규모 장애 발생

```

결과:

- 도메인 모델이 점점 이상해짐
- if/else, 변환 로직 난립
- “왜 이런 필드가 있지?” 상태

#### 🔄 ACL에서 하는 일 (정확히)

| 역할        | 설명                                                                    |
| ----------- | ----------------------------------------------------------------------- |
| 모델 변환   | 외부 DTO를 내부 도메인 모델로 변환하여 내부 모델을 보호                 |
| 용어 번역   | 외부 시스템의 용어를 내부 Ubiquitous Language로 매핑                    |
| 규칙 차단   | 외부 시스템의 잘못된 비즈니스 규칙이나 제약을 내부로 유입되지 않게 차단 |
| 의존성 격리 | 외부 시스템 변경이 내부 도메인에 미치는 영향을 최소화                   |

- Context 간 번역
  - 서로 다른 Context가 통신할 때는 명시적인 번역이 필요합니다. 이것이 Anti-Corruption Layer의 역할입니다.

| 예시 코드:

```typescript
// 주문 Context에서 결제 Context로 요청할 때
class PaymentAntiCorruptionLayer {
  constructor(private paymentService: PaymentService) {}

  // 주문 Context의 언어 → 결제 Context의 언어로 번역
  requestPayment(customer: Customer, order: Order): PaymentResult {
    // Customer → Payer로 번역
    const payer = this.translateToPayer(customer);

    // Order → PaymentRequest로 번역
    const paymentRequest = this.translateToPaymentRequest(order);

    // 결제 Context의 언어로 호출
    return this.paymentService.processPayment(payer, paymentRequest);
  }

  private translateToPayer(customer: Customer): Payer {
    return new Payer(
      PayerId.from(customer.customerId),
      customer.defaultPaymentMethod,
    );
  }

  private translateToPaymentRequest(order: Order): PaymentRequest {
    return new PaymentRequest(
      order.orderId.toString(),
      order.totalAmount,
      order.currency,
    );
  }
}
```

### 2. ACL은 어느 레이어에 두는가?

| 항목        | 내용                                        |
| ----------- | ------------------------------------------- |
| Layer       | Anti-Corruption Layer (ACL)                 |
| ACL 위치    | Bounded Context 경계                        |
| DDD 기준    | Infrastructure Layer 또는 Application Layer |
| Spring 구조 | infrastructure.acl 패키지                   |
| Domain      | ❌ 절대 두면 안 됨                          |

#### 🧠 Bounded Context와 ACL의 관계

```shell
[Context A] ←→ [ACL] ←→ [Context B]
```

- Bounded Context 간 통합은 직접 참조 ❌
- 항상 ACL을 통해서만 통신

#### 🎯 핵심 요약 (시험/면접용)

```plain
DDD에서 ACL은
- Anti-Corruption Layer
- 외부 시스템으로부터 도메인을 보호하는 번역 계층
- 모델/용어/규칙을 변환·차단
- Bounded Context 간 통합의 필수 장치
```
